该函数用于高效计算形如 **一次函数下取整的和** 的数学表达式：

$$f(n, m, a, b) = \sum_{i=0}^{n-1} \lfloor \frac{ai + b}{m} \rfloor$$
```cpp
typedef __int128_t i128; // 处理中间溢出
long long calc(long long a, long long b, long long m, long long n) {
    long long ans = 0;
    if (a < 0) {
        long long a2 = (a % m + m) % m;
        ans -= (i128)n * (n - 1) / 2 * ((a2 - a) / m);
        a = a2;
    }
    if (b < 0) {
        long long b2 = (b % m + m) % m;
        ans -= (i128)n * ((b2 - b) / m);
        b = b2;
    }
    auto solve = [&](auto self, long long n, long long m, long long a, long long b) -> long long {
        long long res = 0;
        if (a >= m) {
            res += (i128)n * (n - 1) / 2 * (a / m);
            a %= m;
        }
        if (b >= m) {
            res += (i128)n * (b / m);
            b %= m;
        }
        long long y_max = (a * n + b) / m;
        if (y_max == 0) return res;
        long long x_max = y_max * m - b;
        res += (i128)(n - (x_max + a - 1) / a) * y_max;
        res += self(self, y_max, a, m, (a - x_max % a) % a);
        return res;
    };
    return ans + solve(solve, n, m, a, b);
}
```